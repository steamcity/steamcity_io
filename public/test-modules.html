<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modules - SteamCity</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Chargement des Modules ES6</h1>

    <div class="test-card">
        <h2>√âtape 1 : Import AuthManager</h2>
        <div id="auth-status">‚è≥ Chargement...</div>
    </div>

    <div class="test-card">
        <h2>√âtape 2 : Import ApiService</h2>
        <div id="api-status">‚è≥ Chargement...</div>
    </div>

    <div class="test-card">
        <h2>√âtape 3 : Instanciation</h2>
        <div id="instance-status">‚è≥ En attente...</div>
    </div>

    <div class="test-card">
        <h2>√âtape 4 : Test API</h2>
        <div id="test-status">‚è≥ En attente...</div>
        <pre id="test-result"></pre>
    </div>

    <script type="module">
        console.log('üîç D√©but des tests de chargement des modules')

        // Test 1 : AuthManager
        try {
            const { AuthManager } = await import('./js/auth-manager.js')
            document.getElementById('auth-status').innerHTML = '‚úÖ <span class="success">AuthManager import√© avec succ√®s</span>'
            console.log('‚úÖ AuthManager:', AuthManager)
            window.AuthManagerClass = AuthManager
        } catch (error) {
            document.getElementById('auth-status').innerHTML = `‚ùå <span class="error">Erreur: ${error.message}</span>`
            console.error('‚ùå Erreur AuthManager:', error)
        }

        // Test 2 : ApiService
        try {
            const { ApiService } = await import('./js/api-service.js')
            document.getElementById('api-status').innerHTML = '‚úÖ <span class="success">ApiService import√© avec succ√®s</span>'
            console.log('‚úÖ ApiService:', ApiService)
            window.ApiServiceClass = ApiService
        } catch (error) {
            document.getElementById('api-status').innerHTML = `‚ùå <span class="error">Erreur: ${error.message}</span>`
            console.error('‚ùå Erreur ApiService:', error)
        }

        // Test 3 : Instanciation
        try {
            if (window.ApiServiceClass) {
                const apiService = new window.ApiServiceClass('/api')
                window.apiService = apiService

                const methods = [
                    'fetchExperiments',
                    'fetchExperimentById',
                    'fetchSensors',
                    'fetchSensorDevices',
                    'fetchSensorById',
                    'fetchSensorTypes',
                    'fetchMeasurements',
                    'fetchProtocols',
                    'uploadCSV',
                    'healthCheck'
                ]

                const availableMethods = methods.filter(m => typeof apiService[m] === 'function')

                document.getElementById('instance-status').innerHTML = `‚úÖ <span class="success">ApiService instanci√© avec ${availableMethods.length}/10 m√©thodes</span>`
                console.log('‚úÖ ApiService instance:', apiService)
                console.log('üì¶ M√©thodes disponibles:', availableMethods)
            }
        } catch (error) {
            document.getElementById('instance-status').innerHTML = `‚ùå <span class="error">Erreur: ${error.message}</span>`
            console.error('‚ùå Erreur instanciation:', error)
        }

        // Test 4 : Appel API r√©el
        try {
            if (window.apiService) {
                document.getElementById('test-status').innerHTML = '‚è≥ Test de healthCheck()...'

                const result = await window.apiService.healthCheck()

                document.getElementById('test-status').innerHTML = '‚úÖ <span class="success">API fonctionne !</span>'
                document.getElementById('test-result').textContent = JSON.stringify(result, null, 2)
                console.log('‚úÖ Health check:', result)

                // Test fetch experiments
                console.log('‚è≥ Test fetchExperiments()...')
                const experiments = await window.apiService.fetchExperiments()
                console.log('‚úÖ Experiments:', experiments.length, 'exp√©riences charg√©es')
            }
        } catch (error) {
            document.getElementById('test-status').innerHTML = `‚ùå <span class="error">Erreur API: ${error.message}</span>`
            document.getElementById('test-result').textContent = error.stack
            console.error('‚ùå Erreur test API:', error)
        }

        console.log('‚úÖ Tests termin√©s - v√©rifiez window.apiService dans la console')
    </script>
</body>
</html>