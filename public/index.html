<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SteamCity IoT platform</title>
    <link rel="stylesheet" href="leaflet.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Page de connexion -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">
                    <h1>SteamCity.io</h1>
                    <p class="tagline">IoT Platform for Educational Experiments</p>
                </div>
            </div>

            <div class="login-content">
                <div class="platform-info">
                    <h2>Bienvenue sur la plateforme SteamCity</h2>
                    <p class="description">
                        SteamCity est une plateforme éducative innovante qui permet aux étudiants et enseignants
                        de réaliser des expériences IoT (Internet of Things) pour comprendre les enjeux urbains
                        et environnementaux contemporains.
                    </p>

                    <div class="features">
                        <div class="feature">
                            <span class="feature-icon">🗺️</span>
                            <div>
                                <h3>Cartographie Interactive</h3>
                                <p>Visualisez les expériences sur une carte interactive avec filtrage par clusters thématiques</p>
                            </div>
                        </div>

                        <div class="feature">
                            <span class="feature-icon">📊</span>
                            <div>
                                <h3>Analyse de Données</h3>
                                <p>Explorez les données de capteurs avec des graphiques interactifs et des outils d'analyse</p>
                            </div>
                        </div>

                        <div class="feature">
                            <span class="feature-icon">🔬</span>
                            <div>
                                <h3>Expériences Éducatives</h3>
                                <p>Accédez à des protocoles pédagogiques basés sur 5 clusters SteamCity</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="login-form-container">
                    <form id="login-form" class="login-form">
                        <h3>Connexion</h3>
                        <div class="form-group">
                            <label for="username">Nom d'utilisateur</label>
                            <input type="text" id="username" name="username" required placeholder="login">
                        </div>

                        <div class="form-group">
                            <label for="password">Mot de passe</label>
                            <input type="password" id="password" name="password" required placeholder="password">
                        </div>

                        <button type="submit" class="btn btn-primary login-btn">
                            🚀 Accéder à la plateforme
                        </button>

                        <div id="login-error" class="error-message" style="display: none;">
                            Identifiants incorrects.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenu principal de la plateforme -->
    <div id="main-platform" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <h1>SteamCity IoT Platform</h1>
                <button id="logout-btn" class="btn btn-outline logout-btn">
                    👤 Déconnexion
                </button>
            </div>
        </header>

        <div class="main-content">
        <div class="tabs">
            <button class="tab-btn active" data-tab="map">🗺️ Carte</button>
            <button class="tab-btn" data-tab="experiments">🔬 Expériences</button>
            <button class="tab-btn" data-tab="sensors">📊 Capteurs</button>
            <button class="tab-btn" data-tab="charts">📈 Graphiques</button>
            <button class="tab-btn" data-tab="upload">📤 Upload CSV</button>
        </div>

        <!-- Onglet Capteurs -->
        <div class="tab-content" id="sensors">
            <div class="card">
                <h2>Données des Capteurs</h2>
                <div class="actions">
                    <button id="refresh-sensors" class="btn btn-primary">🔄 Actualiser</button>
                    <button id="add-sensor" class="btn btn-success">➕ Ajouter Données</button>
                </div>

                <!-- Filtres de recherche -->
                <div class="search-filters" id="search-filters">
                    <div class="filter-toggle">
                        <button id="toggle-filters" class="btn btn-outline">🔍 Filtres de recherche</button>
                    </div>
                    <div class="filters-panel" id="filters-panel" style="display: none;">
                        <div class="filters-grid">
                            <div class="filter-group">
                                <label for="filter-search">🔍 Recherche textuelle:</label>
                                <input type="text" id="filter-search" placeholder="Nom, école, notes...">
                            </div>
                            <div class="filter-group">
                                <label for="filter-experiment">🧪 Expérience:</label>
                                <select id="filter-experiment">
                                    <option value="">Toutes les expériences</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filter-sensor-type">📊 Type de capteur:</label>
                                <select id="filter-sensor-type">
                                    <option value="">Tous les types</option>
                                    <option value="temperature">Température</option>
                                    <option value="humidity">Humidité</option>
                                    <option value="pressure">Pression</option>
                                    <option value="light">Luminosité</option>
                                    <option value="noise">Bruit</option>
                                    <option value="air_quality">Qualité de l'air</option>
                                    <option value="co2">CO2</option>
                                    <option value="ph">pH</option>
                                    <option value="conductivity">Conductivité</option>
                                    <option value="turbidity">Turbidité</option>
                                    <option value="motion">Mouvement</option>
                                    <option value="energy">Énergie</option>
                                    <option value="uv">UV</option>
                                    <option value="wind">Vent</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filter-student">👤 Étudiant:</label>
                                <input type="text" id="filter-student" placeholder="Nom de l'étudiant">
                            </div>
                            <div class="filter-group">
                                <label for="filter-group">👥 Groupe:</label>
                                <input type="text" id="filter-group" placeholder="Groupe A, B, C...">
                            </div>
                            <div class="filter-group">
                                <label for="filter-school">🏫 École:</label>
                                <input type="text" id="filter-school" placeholder="Nom de l'école">
                            </div>
                            <div class="filter-group">
                                <label for="filter-city">🏙️ Ville:</label>
                                <select id="filter-city">
                                    <option value="">Toutes les villes</option>
                                    <option value="Aix-en-Provence">Aix-en-Provence</option>
                                    <option value="Brussels">Brussels</option>
                                    <option value="La Rochelle">La Rochelle</option>
                                    <option value="Madrid">Madrid</option>
                                    <option value="Naples">Naples</option>
                                    <option value="Paris">Paris</option>
                                    <option value="Sofia">Sofia</option>
                                    <option value="Marseille">Marseille</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filter-date-from">📅 Date début:</label>
                                <input type="date" id="filter-date-from">
                            </div>
                            <div class="filter-group">
                                <label for="filter-date-to">📅 Date fin:</label>
                                <input type="date" id="filter-date-to">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button id="apply-filters" class="btn btn-primary">🔍 Appliquer les filtres</button>
                            <button id="clear-filters" class="btn btn-secondary">❌ Effacer</button>
                        </div>
                    </div>
                </div>

                <div id="sensors-list" class="data-list">
                    <div class="loading">Chargement...</div>
                </div>
            </div>

            <!-- Formulaire ajout capteur -->
            <div class="card" id="sensor-form" style="display: none;">
                <h3>Ajouter des Données de Capteur</h3>
                <form id="add-sensor-form">
                    <div class="form-group">
                        <label for="experiment-id-sensor">ID Expérience:</label>
                        <input type="text" id="experiment-id-sensor" required placeholder="ex: exp_123456">
                    </div>
                    <div class="form-group">
                        <label for="student-name">Nom de l'étudiant:</label>
                        <input type="text" id="student-name" required>
                    </div>
                    <div class="form-group">
                        <label for="student-group">Groupe (optionnel):</label>
                        <input type="text" id="student-group">
                    </div>
                    <div class="form-group">
                        <label for="sensor-type">Type de capteur:</label>
                        <select id="sensor-type" required>
                            <option value="">Sélectionner...</option>
                            <option value="temperature">Température</option>
                            <option value="humidity">Humidité</option>
                            <option value="pressure">Pression</option>
                            <option value="light">Luminosité</option>
                            <option value="sound">Son</option>
                            <option value="motion">Mouvement</option>
                            <option value="ph">pH</option>
                            <option value="conductivity">Conductivité</option>
                            <option value="distance">Distance</option>
                            <option value="acceleration">Accélération</option>
                            <option value="other">Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sensor-value">Valeur:</label>
                        <input type="number" step="0.01" id="sensor-value" required>
                    </div>
                    <div class="form-group">
                        <label for="sensor-unit">Unité:</label>
                        <input type="text" id="sensor-unit" required>
                    </div>
                    <div class="form-group">
                        <label for="location-desc">Description localisation (optionnel):</label>
                        <input type="text" id="location-desc" placeholder="ex: Salle A1, Bureau principal">
                    </div>
                    <div class="form-group">
                        <label for="sensor-notes">Notes (optionnel):</label>
                        <textarea id="sensor-notes" rows="2"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">💾 Enregistrer</button>
                        <button type="button" id="cancel-sensor" class="btn btn-secondary">❌ Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Onglet Expériences -->
        <div class="tab-content" id="experiments">
            <div class="card">
                <h2>Expériences</h2>
                <div class="actions">
                    <button id="refresh-experiments" class="btn btn-primary">🔄 Actualiser</button>
                    <button id="add-experiment" class="btn btn-success">➕ Nouvelle Expérience</button>
                </div>

                <!-- Filtres de recherche pour expériences -->
                <div class="search-filters" id="experiments-search-filters">
                    <div class="filter-toggle">
                        <button id="toggle-experiments-filters" class="btn btn-outline">🔍 Filtres de recherche<span id="exp-filters-count" class="filters-count" style="display: none;"></span></button>
                    </div>
                    <div class="filters-panel" id="experiments-filters-panel" style="display: none;">
                        <div class="filters-grid">
                            <div class="filter-group">
                                <label for="exp-filter-search">🔍 Recherche textuelle:</label>
                                <input type="text" id="exp-filter-search" placeholder="Titre, description, étudiant...">
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-protocol">🧪 Protocole:</label>
                                <select id="exp-filter-protocol">
                                    <option value="">Tous les protocoles</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-student">👤 Étudiant:</label>
                                <input type="text" id="exp-filter-student" placeholder="Nom de l'étudiant">
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-group">👥 Groupe:</label>
                                <input type="text" id="exp-filter-group" placeholder="Groupe A, B, C...">
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-school">🏫 École:</label>
                                <input type="text" id="exp-filter-school" placeholder="Nom de l'école">
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-city">🏙️ Ville:</label>
                                <select id="exp-filter-city">
                                    <option value="">Toutes les villes</option>
                                    <option value="Aix-en-Provence">Aix-en-Provence</option>
                                    <option value="Brussels">Brussels</option>
                                    <option value="La Rochelle">La Rochelle</option>
                                    <option value="Madrid">Madrid</option>
                                    <option value="Naples">Naples</option>
                                    <option value="Paris">Paris</option>
                                    <option value="Sofia">Sofia</option>
                                    <option value="Marseille">Marseille</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-language">🌐 Langue:</label>
                                <select id="exp-filter-language">
                                    <option value="">Toutes les langues</option>
                                    <option value="fr">Français</option>
                                    <option value="es">Espagnol</option>
                                    <option value="it">Italien</option>
                                    <option value="bg">Bulgare</option>
                                    <option value="en">Anglais</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-status">📊 Statut:</label>
                                <select id="exp-filter-status">
                                    <option value="">Tous les statuts</option>
                                    <option value="active">Active</option>
                                    <option value="planned">Planifiée</option>
                                    <option value="completed">Terminée</option>
                                    <option value="paused">En pause</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="exp-filter-date-from">📅 Date début:</label>
                                <input type="date" id="exp-filter-date-from">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button id="apply-experiments-filters" class="btn btn-primary">🔍 Appliquer les filtres</button>
                            <button id="clear-experiments-filters" class="btn btn-secondary">❌ Effacer</button>
                        </div>
                    </div>
                </div>

                <div id="experiments-list" class="data-list">
                    <div class="loading">Chargement...</div>
                </div>
            </div>

            <!-- Formulaire ajout expérience -->
            <div class="card" id="experiment-form" style="display: none;">
                <h3>Nouvelle Expérience</h3>
                <form id="add-experiment-form">
                    <div class="form-group">
                        <label for="exp-title">Titre de l'expérience:</label>
                        <input type="text" id="exp-title" required>
                    </div>
                    <div class="form-group">
                        <label for="exp-description">Description:</label>
                        <textarea id="exp-description" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="exp-protocol">Protocole SteamCity:</label>
                        <select id="exp-protocol">
                            <option value="">Sélectionner un protocole...</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exp-student-name">Nom de l'étudiant:</label>
                        <input type="text" id="exp-student-name" required>
                    </div>
                    <div class="form-group">
                        <label for="exp-student-group">Groupe (optionnel):</label>
                        <input type="text" id="exp-student-group">
                    </div>
                    <div class="form-group">
                        <label for="exp-school">École (optionnel):</label>
                        <input type="text" id="exp-school">
                    </div>
                    <div class="form-group">
                        <label for="exp-hypothesis">Hypothèse (optionnel):</label>
                        <textarea id="exp-hypothesis" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="exp-methodology">Méthodologie (optionnel):</label>
                        <textarea id="exp-methodology" rows="2"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">💾 Créer</button>
                        <button type="button" id="cancel-experiment" class="btn btn-secondary">❌ Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Onglet Carte -->
        <div class="tab-content active" id="map">
            <div class="card">
                <h2>Localisation des Expériences</h2>
                <div class="actions">
                    <button id="refresh-map" class="btn btn-primary">🔄 Actualiser Carte</button>
                    <button id="center-map" class="btn btn-secondary">🎯 Centrer</button>
                    <div class="map-controls">
                        <label for="map-filter">Filtrer par cluster :</label>
                        <select id="map-filter">
                            <option value="">Toutes les expériences</option>
                            <option value="governance">Gouvernance et citoyenneté</option>
                            <option value="environmental">Qualité environnementale</option>
                            <option value="mobility">Mobilité</option>
                            <option value="energy">Économies d'énergie</option>
                            <option value="technology">IA et technologies</option>
                        </select>
                    </div>
                </div>
                <div id="sensor-map">
                    <div style="padding: 50px; text-align: center; color: #666;">
                        Cliquez sur cet onglet pour initialiser la carte...
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet Graphiques -->
        <div class="tab-content" id="charts">
            <div class="card">
                <h2>Analyse des Données</h2>
                <div class="actions">
                    <div class="chart-controls">
                        <label for="chart-experiment">Expérience:</label>
                        <select id="chart-experiment">
                            <option value="">Toutes les expériences</option>
                        </select>

                        <label for="chart-sensor-type">Type de capteur:</label>
                        <select id="chart-sensor-type">
                            <option value="">Tous les types</option>
                            <option value="temperature">Température</option>
                            <option value="humidity">Humidité</option>
                            <option value="pressure">Pression</option>
                            <option value="light">Luminosité</option>
                            <option value="sound">Son</option>
                            <option value="motion">Mouvement</option>
                            <option value="ph">pH</option>
                            <option value="conductivity">Conductivité</option>
                            <option value="distance">Distance</option>
                            <option value="acceleration">Accélération</option>
                            <option value="other">Autre</option>
                        </select>

                        <label for="chart-period">Période:</label>
                        <select id="chart-period">
                            <option value="24h">Dernières 24h</option>
                            <option value="7d">7 derniers jours</option>
                            <option value="30d">30 derniers jours</option>
                            <option value="all" selected>Toutes les données</option>
                        </select>

                        <button id="update-chart" class="btn btn-primary">📊 Mettre à jour</button>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <canvas id="timeSeriesChart"></canvas>
                    </div>
                </div>
                <div id="chart-stats" class="chart-stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Total de mesures:</span>
                            <span id="total-measurements" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Moyenne:</span>
                            <span id="average-value" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Minimum:</span>
                            <span id="min-value" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Maximum:</span>
                            <span id="max-value" class="stat-value">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet Upload CSV -->
        <div class="tab-content" id="upload">
            <div class="card">
                <h2>Import CSV</h2>
                <p>Téléversez un fichier CSV contenant des données de capteurs</p>
                <form id="upload-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="csv-file">Fichier CSV:</label>
                        <input type="file" id="csv-file" accept=".csv" required>
                    </div>
                    <div class="form-group">
                        <label for="experiment-id">ID Expérience (optionnel):</label>
                        <input type="text" id="experiment-id">
                    </div>
                    <button type="submit" class="btn btn-success">📤 Téléverser</button>
                </form>
                <div id="upload-result" class="result-message"></div>
            </div>
        </div>
        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-top">
                    <div class="footer-left">
                        <p>&copy; 2025 <a href="https://www.steamcity.eu/" target="_blank" rel="noopener">SteamCity Project</a></p>
                    </div>
                    <div class="footer-right">
                        <span id="api-status" class="status-badge">Vérification...</span>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="footer-left">
                        <img src="eu-funded-logo.png" alt="Co-funded by the European Union" class="eu-logo">
                    </div>
                    <div class="eu-disclaimer">
                        Funded by the European Union. Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Education and Culture Executive Agency (EACEA). Neither the European Union nor EACEA can be held responsible for them.
                    </div>
                </div>
            </div>
        </footer>

        </div> <!-- Fermeture main-content -->
    </div> <!-- Fermeture main-platform -->

    <script src="leaflet.js"></script>
    <script src="chart.js"></script>
    <script src="chartjs-adapter-date-fns.js"></script>
    <script src="script.js"></script>
</body>
</html>